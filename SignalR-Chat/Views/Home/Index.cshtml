@{
    ViewBag.Title = "SignalR Chat";
}
<div>
    @Html.DropDownList("users", (SelectList)ViewBag.Users, new { id = "user"})
    <input id="message" type="text" />
    <button id="send">Send</button>

</div>
<div id="messages">

</div>

@section scripts {
    @*SignalR jquery library is required and is referenced in _scripts
    Reference of SignalR library below.*@
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    @*Reference the autogenerated SignalR hub script*@
    <script src="~/signalr/hubs"></script>
    <script>
        $(document).ready(() => {
            let chat = $.connection.chatHub;
            //Get message from Hub
            chat.client.gotMessage = (from, message) => {
                $('#messages').append(`<p>${from}: ${message}</p>`);
            }

            chat.client.broadcast = (message) => {
                $('#messages').append(`<p><strong>Announcement: ${message}</strong></p>`);
            }

            //start the connection
            $.connection.hub.start().done(() => {
                //only when connected call chat.server
                $('#send').click(() => {
                    //TODO send message to hub
                    chat.server.sendToUser($('#user').val(), $('#message').val());
                    //Append my own message
                    $('#messages').append(`<p>Me: ${$('#message').val()}</p>`);
                    //Reset message input
                    $('#message').val('').focus();
                });
            });
        });
    </script>
}